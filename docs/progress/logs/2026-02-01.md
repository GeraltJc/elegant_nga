# 2026-02-01 - Daily Log

## Summary

- 落地调度方案：scheduler 容器 + 固定时间点触发 + 调度日志，并完成数据库一致性验收

## Work

- 新增 scheduler 服务（Docker Compose）并设置 `restart: unless-stopped`
- 新增调度包装命令 `nga:crawl-lite-and-audit`，抓取成功后延迟 5 分钟再审计
- 调度任务固定在 `03:00 / 10:00 / 15:00`（Asia/Shanghai），并启用互斥
- 应用时区改为 `APP_TIMEZONE`，统一为 Asia/Shanghai
- 新增调度日志通道 `scheduler`，按天切分并保留 14 天
- 新增触发来源参数 `--trigger-text`，调度写入 `scheduler`，手动保持 `manual`
- 更新文档：README / 开发环境设置指南 / 项目架构规划文档 / 数据库注释清单 / 迁移注释
- 归档调度测试与验证日志到 `backend/storage/logs/archive/`
- 执行验收：
  - `php artisan schedule:list` 校验三次调度
  - 手动运行调度命令并验证日志落盘
  - 数据库一致性核对（`crawl_runs` / `crawl_run_threads` / `thread_floor_audit_runs` / `thread_floor_audit_threads`）
- 产出验收记录：`docs/验收记录/2026-02-01-scheduler-数据库一致性验收.md`

## Tasks Touched

- T-0008

## Decisions / ADR

- 无

## Risks / Blockers

- 审计修补会触发 `floor_audit` 类型的抓取 run（正常行为，需在报表口径中区分）

## Next

- 观察下一次定时触发，确认调度日志按天生成
